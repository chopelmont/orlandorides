<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orlando VIP Transport</title>
    <style>
        :root { --blue: #38bdf8; --bg: #0f172a; --card: #1e293b; --green: #22c55e; --red: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        
        .lang-switch { margin-bottom: 15px; display: flex; gap: 10px; align-items: center; }
        .lang-btn { background: #334155; border: 1px solid var(--blue); color: white; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: bold; }
        .lang-btn.active { background: var(--blue); color: #0f172a; }

        .status-btn { background: var(--green); border: none; color: white; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .status-btn.busy { background: var(--red); }

        .container { background: var(--card); width: 100%; max-width: 420px; padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.05); box-sizing: border-box; }
        h2 { text-align: center; color: var(--blue); margin: 0 0 20px; font-weight: 800; text-transform: uppercase; }
        
        .field { margin-bottom: 18px; }
        label { display: block; font-size: 11px; color: var(--blue); margin-bottom: 6px; font-weight: 800; text-transform: uppercase; }
        input { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #334155; background: #0b1120; color: white; box-sizing: border-box; font-size: 16px; }
        
        .services { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 20px 0; }
        .srv-card { background: #111; padding: 12px 5px; border-radius: 15px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .srv-card.active { border-color: var(--blue); background: rgba(56, 189, 248, 0.1); }
        .srv-card b { display: block; color: var(--blue); font-size: 13px; margin-top: 4px; }

        .btn-calc { width: 100%; padding: 18px; background: var(--blue); border: none; border-radius: 15px; color: #0f172a; font-weight: 900; font-size: 16px; cursor: pointer; text-transform: uppercase; }
        
        #results { margin-top: 25px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 20px; display: none; text-align: center; border: 1px solid rgba(56, 189, 248, 0.2); }
        .price { font-size: 42px; color: var(--green); font-weight: 900; margin: 5px 0; }
        .wa-btn { display: flex; align-items: center; justify-content: center; background: #25d366; color: white; text-decoration: none; padding: 16px; border-radius: 15px; font-weight: 800; margin-top: 15px; }
        
        .footer { text-align: center; font-size: 10px; opacity: 0.3; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div class="lang-switch">
    <button class="lang-btn active" onclick="setLang('es', this)">ESPA√ëOL</button>
    <button class="lang-btn" onclick="setLang('en', this)">ENGLISH</button>
    <button id="st-btn" class="status-btn" onclick="toggleStatus()">Disponible</button>
</div>

<div class="container">
    <h2 id="t-title">Orlando Ride Pro</h2>
    <div class="field">
        <label id="l-pickup">üìç Lugar de Recogida</label>
        <input type="text" id="origin" placeholder="...">
    </div>
    <div class="field">
        <label id="l-dest">üèÅ Lugar de Destino</label>
        <input type="text" id="dest" placeholder="...">
    </div>
    <div style="display: flex; gap: 12px;">
        <div class="field" style="flex:1"><label id="l-date">Fecha</label><input type="date" id="date"></div>
        <div class="field" style="flex:1"><label id="l-time">Hora</label><input type="time" id="time"></div>
    </div>
    <label id="l-vehicle">üöó Tipo de Veh√≠culo</label>
    <div class="services">
        <div class="srv-card active" onclick="sel(2.5, 'Standard', this)">
            <span class="srv-name">Standard</span><b>$2.50/mi</b>
        </div>
        <div class="srv-card" onclick="sel(3.5, 'SUV Luxury', this)">
            <span class="srv-name">SUV Lux</span><b>$3.50/mi</b>
        </div>
        <div class="srv-card" onclick="sel(5.5, 'Van XL', this)">
            <span class="srv-name">Van XL</span><b>$5.50/mi</b>
        </div>
    </div>
    <button class="btn-calc" id="b-calc" onclick="estimate()">Calcular mi Tarifa</button>
    <div id="results">
        <div id="l-total" style="font-size: 11px; font-weight: bold; opacity: 0.6; text-transform: uppercase;">Estimado Total</div>
        <div class="price" id="res-p">$0.00</div>
        <div id="res-d" style="font-size: 14px; color: #cbd5e1;">0 mi | 0 min</div>
        <a href="#" id="wa-link" class="wa-btn" target="_blank">RESERVAR POR WHATSAPP</a>
    </div>
    <div class="footer" onclick="configPhone()">‚öôÔ∏è CONFIG</div>
</div>

<script>
    // IMPORTANTE: PEGA TU URL DE FIREBASE AQU√ç (Mant√©n la barra / al final y el .json)
    const dbURL = "https://chopelridepro-default-rtdb.firebaseio.com//status.json";

    let rate = 2.5, srv = "Standard", currentLang = 'es', isOnline = true;
    let myPhone = localStorage.getItem('driverPhone') || "13213305001";
    let fixedDist = 0; 

    const texts = {
        es: { title: "Orlando Ride Pro", pickup: "üìç Lugar de Recogida", dest: "üèÅ Lugar de Destino", date: "Fecha", time: "Hora", vehicle: "üöó Tipo de Veh√≠culo", calc: "Calcular Tarifa", total: "Estimado Total", book: "RESERVAR POR WHATSAPP", bookBusy: "CONSULTAR DISPONIBILIDAD", alert: "Completa los datos", msg: "NUEVA RESERVA", stOn: "Disponible", stOff: "Ocupado" },
        en: { title: "Orlando Ride Pro", pickup: "üìç Pickup Location", dest: "üèÅ Drop-off Location", date: "Date", time: "Time", vehicle: "üöó Vehicle Type", calc: "Calculate Fare", total: "Estimated Total", book: "BOOK VIA WHATSAPP", bookBusy: "CHECK AVAILABILITY", alert: "Please fill all fields", msg: "NEW BOOKING", stOn: "Available", stOff: "Busy" }
    };

    // Funci√≥n para SINCRONIZAR estado con el servidor
    async function toggleStatus() {
        const newState = !isOnline;
        try {
            await fetch(dbURL, {
                method: 'PUT',
                body: JSON.stringify({ online: newState })
            });
        } catch (e) { console.error("Error sincronizando", e); }
    }

    // Escuchar cambios en tiempo real (Pooling sencillo cada 3 segundos)
    async function checkStatus() {
        try {
            const res = await fetch(dbURL);
            const data = await res.json();
            if(data && data.online !== isOnline) {
                isOnline = data.online;
                updateUIStatus();
            }
        } catch (e) {}
    }
    setInterval(checkStatus, 3000); // Revisa cada 3 segundos si cambiaste el bot√≥n

    function updateUIStatus() {
        const btn = document.getElementById('st-btn');
        btn.innerText = isOnline ? texts[currentLang].stOn : texts[currentLang].stOff;
        btn.classList.toggle('busy', !isOnline);
        if(fixedDist > 0) updateDisplay();
    }

    function setLang(lang, btn) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('t-title').innerText = texts[lang].title;
        document.getElementById('l-pickup').innerText = texts[lang].pickup;
        document.getElementById('l-dest').innerText = texts[lang].dest;
        document.getElementById('l-date').innerText = texts[lang].date;
        document.getElementById('l-time').innerText = texts[lang].time;
        document.getElementById('l-vehicle').innerText = texts[lang].vehicle;
        document.getElementById('b-calc').innerText = texts[lang].calc;
        document.getElementById('l-total').innerText = texts[lang].total;
        updateUIStatus();
    }

    function sel(r, n, e) {
        document.querySelectorAll('.srv-card').forEach(c => c.classList.remove('active'));
        e.classList.add('active');
        rate = r; srv = n;
        if(fixedDist > 0) updateDisplay(); 
    }

    function estimate() {
        const o = document.getElementById('origin').value;
        const d = document.getElementById('dest').value;
        if (!o || !d || !document.getElementById('date').value) {
            alert(texts[currentLang].alert); return;
        }
        if(fixedDist === 0) fixedDist = Math.floor(Math.random() * (25 - 12 + 1)) + 12;
        updateDisplay();
    }

    function updateDisplay() {
        let total = (fixedDist * rate).toFixed(2);
        if(parseFloat(total) < 15) total = "15.00"; 
        document.getElementById('res-p').innerText = `$${total}`;
        document.getElementById('res-d').innerText = `${fixedDist} mi | ~${Math.round(fixedDist * 2.3)} min`;
        document.getElementById('results').style.display = 'block';

        const waBtn = document.getElementById('wa-link');
        waBtn.innerText = isOnline ? texts[currentLang].book : texts[currentLang].bookBusy;

        const info = `\nüìç De: ${document.getElementById('origin').value}\nüèÅ A: ${document.getElementById('dest').value}\nüìÖ Fecha: ${document.getElementById('date').value}\n‚åö Hora: ${document.getElementById('time').value}\nüöó Auto: ${srv}\nüí∞ Total: $${total}`;
        let msg = `*${isOnline ? texts[currentLang].msg : 'CONSULTA DISPONIBILIDAD'}*\n${info}\n\n`;
        const waLink = `https://wa.me/${myPhone}?text=`;
        if(isOnline) {
            msg += `‚úÖ Aceptar: ${waLink}${encodeURIComponent("¬°Reserva confirmada! üëç")}\n\n`;
        } else {
            msg += `‚è≥ Esperar: ${waLink}${encodeURIComponent("Estoy en servicio. ¬øMe da 10 min y le confirmo? üìû")}\n\n`;
        }
        msg += `‚ùå Declinar: ${waLink}${encodeURIComponent("No disponible. üòî")}`;
        waBtn.href = `https://wa.me/${myPhone}?text=${encodeURIComponent(msg)}`;
    }

    function configPhone() {
        const p = prompt("WhatsApp (ej: 14071234567):", myPhone);
        if(p) { localStorage.setItem('driverPhone', p); myPhone = p; }
    }
</script>
</body>
</html>