<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chopel Transport Orlando</title>
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" type="image/png" href="icon.png">
<meta name="apple-mobile-web-app-title" content="Chopel Transport Orlando">
<meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<link rel="apple-touch-startup-image" href="splash.png">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="theme-color" content="#0f172a">

    <style>
.install-btn { 
    background: #1e293b; 
    border: 1px solid var(--blue); 
    color: var(--blue); 
    padding: 10px; 
    border-radius: 12px; 
    font-size: 13px; 
    font-weight: bold; 
    margin-bottom: 15px; 
    cursor: pointer; 
    display: flex; 
    align-items: center; 
    gap: 8px;
    animation: pulse 2s infinite;
}
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.03); }
    100% { transform: scale(1); }
}
        :root { --blue: #38bdf8; --bg: #0f172a; --card: #1e293b; --green: #22c55e; --red: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .lang-switch { margin-bottom: 15px; display: flex; gap: 10px; align-items: center; }
        .lang-btn { background: #334155; border: 1px solid var(--blue); color: white; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: bold; }
        .lang-btn.active { background: var(--blue); color: #0f172a; }
        .status-btn { background: var(--green); border: none; color: white; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: bold; text-transform: uppercase; min-width: 110px; transition: 0.3s; }
        .status-btn.busy { background: var(--red); }
        .container { background: var(--card); width: 100%; max-width: 420px; padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.05); box-sizing: border-box; position: relative; }
        h2 { text-align: center; color: var(--blue); margin: 0 0 20px; font-weight: 800; text-transform: uppercase; }
        .field { margin-bottom: 18px; position: relative; }
        label { display: block; font-size: 11px; color: var(--blue); margin-bottom: 6px; font-weight: 800; text-transform: uppercase; }
        input { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #334155; background: #0b1120; color: white; box-sizing: border-box; font-size: 16px; }
        .suggestions { position: absolute; top: 100%; left: 0; width: 100%; background: #1e293b; border: 1px solid var(--blue); border-radius: 0 0 12px 12px; z-index: 100; max-height: 200px; overflow-y: auto; display: none; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .suggestion-item { padding: 12px; font-size: 13px; cursor: pointer; border-bottom: 1px solid #334155; line-height: 1.4; color: #cbd5e1; }
        .services { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 20px 0; }
        .srv-card { background: #111; padding: 12px 5px; border-radius: 15px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .srv-card.active { border-color: var(--blue); background: rgba(56, 189, 248, 0.1); }
        .srv-card b { display: block; color: var(--blue); font-size: 13px; margin-top: 4px; }
        .btn-calc { width: 100%; padding: 18px; background: var(--blue); border: none; border-radius: 15px; color: #0f172a; font-weight: 900; font-size: 16px; cursor: pointer; text-transform: uppercase; }
        #results { margin-top: 25px; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 20px; display: none; text-align: center; border: 1px solid rgba(56, 189, 248, 0.2); }
        .price { font-size: 42px; color: var(--green); font-weight: 900; margin: 5px 0; }
        .wa-btn { display: flex; align-items: center; justify-content: center; background: #25d366; color: white; text-decoration: none; padding: 16px; border-radius: 15px; font-weight: 800; margin-top: 15px; }
        .footer { text-align: center; font-size: 10px; opacity: 0.3; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div class="lang-switch">
    <button class="lang-btn active" onclick="setLang('es', this)">ESPA√ëOL</button>
    <button class="lang-btn" onclick="setLang('en', this)">ENGLISH</button>
    <button id="st-btn" class="status-btn" onclick="toggleStatus()">Disponible</button>
</div>

<div class="container">
<button class="install-btn" onclick="showInstallInfo()">
    üì≤ INSTALAR APP EN MI TEL√âFONO
</button>
    <h2 id="t-title">Chopel Transport Orlando</h2>
    <div class="field">
        <label id="l-pickup">üìç Lugar de Recogida</label>
        <input type="text" id="origin" placeholder="Ej: Orlando Airport" oninput="searchLoc(this, 'origin-list')">
autocomplete="off" autocorrect="off" spellcheck="false">
        <div id="origin-list" class="suggestions"></div>
    </div>
    <div class="field">
        <label id="l-dest">üèÅ Lugar de Destino</label>
        <input type="text" id="dest" placeholder="Ej: Disney World" oninput="searchLoc(this, 'dest-list')">
autocomplete="off" autocorrect="off" spellcheck="false">
        <div id="dest-list" class="suggestions"></div>
    </div>
    <div style="display: flex; gap: 12px;">
        <div class="field" style="flex:1"><label id="l-date">Fecha</label><input type="date" id="date"></div>
        <div class="field" style="flex:1"><label id="l-time">Hora</label><input type="time" id="time"></div>
    </div>
    <label id="l-vehicle">üöó Tipo de Veh√≠culo</label>
    <div class="services">
        <div class="srv-card" onclick="sel(1.5, 'SUV Luxury', this)">SUV Comfort 4 Pass<b>$1.50/mi</b></div>
        <div class="srv-card" onclick="sel(2.5, 'Van XL', this)">SUV XL 6 Pass<b>$2.50/mi</b></div>
    </div>
    <button class="btn-calc" id="b-calc" onclick="estimate()">Calcular mi Tarifa</button>
    <div id="results">
        <div id="l-total" style="font-size: 11px; font-weight: bold; opacity: 0.6;">ESTIMADO TOTAL</div>
        <div class="price" id="res-p">$0.00</div>
        <div id="res-d" style="font-size: 14px; color: #cbd5e1;">0 mi | 0 min</div>
        <a href="#" id="wa-link" class="wa-btn" target="_blank">RESERVAR POR WHATSAPP</a>
    </div>
    <div class="footer" onclick="configPhone()">‚öôÔ∏è CONFIG</div>
</div>

<script>
    // IMPORTANTE: PEGA TU URL DE FIREBASE AQU√ç (Mant√©n la barra / al final y el .json)
    const dbURL = "https://orlandoridechopel-default-rtdb.firebaseio.com//status.json";

    let rate = 2.5, srv = "Standard", currentLang = 'es', isOnline = true;
    let myPhone = localStorage.getItem('driverPhone') || "13213305001";
    let fixedDist = 0; 

    const texts = {
        es: { title: "Chopel Transport Orlando", pickup: "üìç Lugar de Recogida", dest: "üèÅ Lugar de Destino", date: "Fecha", time: "Hora", vehicle: "üöó Tipo de Veh√≠culo", calc: "Calcular Tarifa", total: "Estimado Total", book: "RESERVAR POR WHATSAPP", bookBusy: "CONSULTAR DISPONIBILIDAD", alert: "Completa los datos", msg: "NUEVA RESERVA", stOn: "Disponible", stOff: "Ocupado" },
        en: { title: "Chopel Transport orlando", pickup: "üìç Pickup Location", dest: "üèÅ Drop-off Location", date: "Date", time: "Time", vehicle: "üöó Vehicle Type", calc: "Calculate Fare", total: "Estimated Total", book: "BOOK VIA WHATSAPP", bookBusy: "CHECK AVAILABILITY", alert: "Please fill all fields", msg: "NEW BOOKING", stOn: "Available", stOff: "Busy" }
    };
let locCoords = { origin: null, dest: null };

    async function searchLoc(input, listId) {
        const query = input.value;
        const list = document.getElementById(listId);
        fixedDist = 0; 
        if (query.length < 4) { list.style.display = 'none'; return; }

        try {
            // A√±adimos un peque√±o retraso para no saturar el celular mientras escribes
            const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}+Florida&limit=5`);
            const data = await response.json();
            list.innerHTML = '';
            if (data.length > 0) {
                list.style.display = 'block';
                data.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerText = item.display_name;
                    div.onclick = () => {
                        input.value = item.display_name;
                        list.style.display = 'none';
                        const type = listId.split('-')[0];
                        locCoords[type] = { lat: parseFloat(item.lat), lon: parseFloat(item.lon) };
                        // Esto ayuda a que el celular reconozca que ya seleccionaste algo
                        input.blur(); 
                    };
                    list.appendChild(div);
                });
            }
        } catch (e) { console.error("Error en b√∫squeda"); }
    }
    // Funci√≥n para SINCRONIZAR estado con el servidor
    async function toggleStatus() {
        const newState = !isOnline;
        try {
            await fetch(dbURL, {
                method: 'PUT',
                body: JSON.stringify({ online: newState })
            });
        } catch (e) { console.error("Error sincronizando", e); }
    }

    // Escuchar cambios en tiempo real (Pooling sencillo cada 3 segundos)
    async function checkStatus() {
        try {
            const res = await fetch(dbURL);
            const data = await res.json();
            if(data && data.online !== isOnline) {
                isOnline = data.online;
                updateUIStatus();
            }
        } catch (e) {}
    }
    setInterval(checkStatus, 3000); // Revisa cada 3 segundos si cambiaste el bot√≥n

    function updateUIStatus() {
        const btn = document.getElementById('st-btn');
        btn.innerText = isOnline ? texts[currentLang].stOn : texts[currentLang].stOff;
        btn.classList.toggle('busy', !isOnline);
        if(fixedDist > 0) updateDisplay();
    }

    function setLang(lang, btn) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('t-title').innerText = texts[lang].title;
        document.getElementById('l-pickup').innerText = texts[lang].pickup;
        document.getElementById('l-dest').innerText = texts[lang].dest;
        document.getElementById('l-date').innerText = texts[lang].date;
        document.getElementById('l-time').innerText = texts[lang].time;
        document.getElementById('l-vehicle').innerText = texts[lang].vehicle;
        document.getElementById('b-calc').innerText = texts[lang].calc;
        document.getElementById('l-total').innerText = texts[lang].total;
        document.getElementById('st-btn').innerText = isOnline ? texts[lang].stOn : texts[lang].stOff;
    }

    function sel(r, n, e) {
        document.querySelectorAll('.srv-card').forEach(c => c.classList.remove('active'));
        e.classList.add('active');
        rate = r; srv = n;
        if(fixedDist > 0) updateDisplay(); 
    }

    function estimate() {
        if (!document.getElementById('origin').value || !document.getElementById('dest').value || !document.getElementById('date').value || !document.getElementById('time').value) {
            alert(texts[currentLang].alert); return;
        }
        if(locCoords.origin && locCoords.dest) {
            const R = 3958.8;
            const dLat = (locCoords.dest.lat - locCoords.origin.lat) * Math.PI / 180;
            const dLon = (locCoords.dest.lon - locCoords.origin.lon) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(locCoords.origin.lat * Math.PI / 180) * Math.cos(locCoords.dest.lat * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            fixedDist = Math.round((R * c) * 1.45);
            if(fixedDist < 2) fixedDist = 5; 
        } else { fixedDist = 16; }
        updateDisplay();
    }

    function updateDisplay() {
        let total = (fixedDist * rate).toFixed(2);
        if(parseFloat(total) < 20) total = "20.00"; 
        document.getElementById('res-p').innerText = `$${total}`;
        document.getElementById('res-d').innerText = `${fixedDist} mi | ~${Math.round(fixedDist * 2.2)} min`;
        document.getElementById('results').style.display = 'block';
        const waBtn = document.getElementById('wa-link');
        waBtn.innerText = isOnline ? texts[currentLang].book : texts[currentLang].bookBusy;

  
let msg = `*${isOnline ? texts[currentLang].msg : 'CONSULTA DE DISPONIBILIDAD'}*\nüìç De:${document.getElementById('origin').value}\nüèÅ A: ${document.getElementById('dest').value}\nüìÖ Fecha: ${document.getElementById('date').value}\n‚åö Hora: ${document.getElementById('time').value}\nüöó Auto: ${srv}\nüí∞ Total: $${total}\n\n`;
        const waLink = `https://wa.me/${myPhone}?text=`;

        if(isOnline) {
            msg += `‚úÖ Aceptar: ${waLink}${encodeURIComponent("Viaje aceptado, por favor envieme su nombre para confirmar al llegar. ¬°Reserva confirmada! üëç")}\n\n`;
        } else {
            msg += `‚è≥ Esperar: ${waLink}${encodeURIComponent("Estoy en servicio. ¬øMe da unos min y le confirmo? üìû")}\n\n`;
        }
        msg += `‚ùå Declinar: ${waLink}${encodeURIComponent("No disponible por el momento üòî , Gracias por Contactarnos, Puede descargar el Link en su telefono y reservar con nosotrosüôè")}`;

        waBtn.href = `https://wa.me/${myPhone}?text=${encodeURIComponent(msg)}`;
    }


    function configPhone() {
        const p = prompt("WhatsApp (ej: 14071234567):", myPhone);
        if(p) { localStorage.setItem('driverPhone', p); myPhone = p; }
    }
function showInstallInfo() {
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    if (isIOS) {
        alert("PARA INSTALAR EN IPHONE:\n\n1. Toca el bot√≥n 'Compartir' (el cuadro con una flecha arriba üì§) en la parte inferior.\n2. Busca y toca en 'Agregar a inicio' (Add to Home Screen ‚ûï).\n3. ¬°Listo! Ya nos tendr√°s en tu pantalla.");
    } else {
        alert("PARA INSTALAR EN ANDROID:\n\n1. Toca los 3 puntos (‚ãÆ) en la esquina superior derecha.\n2. Toca en 'Instalar aplicaci√≥n' o 'Agregar a la pantalla de inicio'.\n3. ¬°Listo! Acceso directo creado.");
    }
}
</script>
</body>
</html>